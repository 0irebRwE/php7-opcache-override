# PHP OPcache Override

This project contains the demo website and the tools presented in the following blog post : 
http://blog.gosecure.ca/2016/04/27/binary-webshell-through-opcache-in-php-7

## 010 Editor Template

This template parses OPcache files generated by a 32bit platform. 

 - Download [010 editor](http://www.sweetscape.com/010editor/)
 - `Templates` -> `Open Template...` Select OPCACHE_x86.bt
 - Open your OPcache file
 - Press `F5`

## Python System ID Scraper

This tool lets you extract the `system_id` of a `phpinfo()` page. 
Simply pass a filename or a URL.

    $ ./system_id_scraper.py info.html
    PHP version : 7.0.4-7ubuntu2
    Zend Extension ID : API320151012,NTS
    Zend Bin ID : BIN_SIZEOF_CHAR48888
    Assuming x86_64 architecture
    ------------
    System ID : 81d80d78c6ef96b89afaadc7ffc5d7ea

## OPcache Disassembler
This tool lets you disassemble an OPcache file.

You can display it as a syntax tree (-t) or pseudocode (-c).
Simply pass a display option and an OPcache file.

    $ ./opcache_disassembler.py -c malware.php.bin
    
    #0 $280 = FETCH_IS('_GET', None);
    #1 ~0 = ISSET_ISEMPTY_DIM_OBJ($280, 'test');
    #2 JMPZ(~408, ->5);
    #3 ECHO('success', None);
    ...


## OPcache Malware Detect
This tool helps detect malware hidden in OPcache files by searching specific keywords in the file's opcodes.

Pass an OPcache file or directory and the detector will recursively go through all the `.php.bin` files.

    $ ./opcache_malware_detect.py malware.php.bin
    Checking malware.php.bin
    	Found potentially dangerous keyword 'preg_replace'.
    	Found potentially dangerous keyword 'str_rot13'.

## Demo
To setup the demo, run the following two commands : 

    sudo ./setup.sh
    php -S 127.0.0.1:8080 -c php.ini
